<!DOCTYPE html>
<html>
<head>
    <title>TrueBooks Accounting Bidding Calculator</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        /* ... (keeping all existing styles) ... */
        .error-input {
            border-color: #dc2626 !important;
            background-color: #fee2e2 !important;
        }

        .error-message {
            color: #dc2626;
            font-size: 12px;
            margin-top: 4px;
            display: none;
        }

        .show-error {
            display: block;
        }
    </style>
</head>
<body>
    <!-- ... (keeping existing HTML structure) ... -->
    <script>
        function validateInputs() {
            // Get service requirement inputs
            const bankAccounts = Number(document.getElementById('bankAccounts').value) || 0;
            const creditCards = Number(document.getElementById('creditCards').value) || 0;
            const transactions = Number(document.getElementById('transactions').value) || 0;
            const properties = Number(document.getElementById('properties').value) || 0;
            const monthlyAJEs = Number(document.getElementById('monthlyAJEs').value) || 0;

            // Get corresponding time allocation inputs
            const bankHours = Number(document.getElementById('bankHours').value) || 0;
            const ccHours = Number(document.getElementById('ccHours').value) || 0;
            const transHours = Number(document.getElementById('transHours').value) || 0;
            const propHours = Number(document.getElementById('propHours').value) || 0;
            const ajeHours = Number(document.getElementById('ajeHours').value) || 0;

            // Validation rules
            const validations = [
                {
                    requirement: bankAccounts,
                    hours: bankHours,
                    inputId: 'bankHours',
                    message: 'Time allocation required when bank accounts are present'
                },
                {
                    requirement: creditCards,
                    hours: ccHours,
                    inputId: 'ccHours',
                    message: 'Time allocation required when credit cards are present'
                },
                {
                    requirement: transactions,
                    hours: transHours,
                    inputId: 'transHours',
                    message: 'Time allocation required when transactions are present'
                },
                {
                    requirement: properties,
                    hours: propHours,
                    inputId: 'propHours',
                    message: 'Time allocation required when properties are present'
                },
                {
                    requirement: monthlyAJEs,
                    hours: ajeHours,
                    inputId: 'ajeHours',
                    message: 'Time allocation required when AJEs are present'
                }
            ];

            // Clear previous errors
            document.querySelectorAll('.error-input').forEach(el => el.classList.remove('error-input'));
            document.querySelectorAll('.error-message').forEach(el => el.classList.remove('show-error'));

            // Check each validation rule
            validations.forEach(({ requirement, hours, inputId, message }) => {
                const input = document.getElementById(inputId);
                const errorMessage = input.parentElement.querySelector('.error-message') || 
                    createErrorMessage(input.parentElement, message);

                if (requirement > 0 && hours === 0) {
                    input.classList.add('error-input');
                    errorMessage.classList.add('show-error');
                }
            });

            // Prevent negative values
            document.querySelectorAll('input[type="number"]').forEach(input => {
                if (parseFloat(input.value) < 0) {
                    input.value = 0;
                }
            });
        }

        function createErrorMessage(parent, message) {
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error-message';
            errorDiv.textContent = message;
            parent.appendChild(errorDiv);
            return errorDiv;
        }

        function roundToNearest10(num) {
            return Math.round(num / 10) * 10;
        }

        function calculate() {
            // Validate inputs first
            validateInputs();

            // Original calculation logic
            const hourlyRate = Number(document.getElementById('hourlyRate').value) || 150;
            const qbFee = Number(document.getElementById('qbVersion').value) || 0;

            const bankHours = Number(document.getElementById('bankHours').value) || 0;
            const ccHours = Number(document.getElementById('ccHours').value) || 0;
            const transHours = Number(document.getElementById('transHours').value) || 0;
            const propHours = Number(document.getElementById('propHours').value) || 0;
            const ajeHours = Number(document.getElementById('ajeHours').value) || 0;
            const otherHours = Number(document.getElementById('otherHours').value) || 0;

            const totalHours = bankHours + ccHours + transHours + propHours + ajeHours + otherHours;
            document.getElementById('totalHours').textContent = totalHours.toFixed(2);

            const basePrice = (totalHours * hourlyRate);
            const midPrice = roundToNearest10(basePrice * 1.3);
            const highPrice = roundToNearest10(basePrice * 1.5);

            const basePriceWithQB = basePrice + qbFee;
            const midPriceWithQB = midPrice + qbFee;
            const highPriceWithQB = highPrice + qbFee;

            document.getElementById('basePrice').textContent = basePriceWithQB ? `$${basePriceWithQB.toFixed(2)}` : '$0.00';
            document.getElementById('midPrice').textContent = midPriceWithQB ? `$${midPriceWithQB.toFixed(2)}` : '$0.00';
            document.getElementById('highPrice').textContent = highPriceWithQB ? `$${highPriceWithQB.toFixed(2)}` : '$0.00';

            document.getElementById('warning').style.display = 
                highPriceWithQB > 1500 ? 'block' : 'none';
        }

        // Add event listeners to all inputs
        document.querySelectorAll('input, select').forEach(input => {
            input.addEventListener('input', calculate);
            input.addEventListener('change', calculate);
        });

        // Initial calculation
        calculate();
    </script>
</body>
</html>
